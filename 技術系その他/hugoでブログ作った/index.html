<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,user-scalable=no"><link rel=stylesheet href=https://OrangeCocoa.github.io//style.css><title>ぶろぐ</title></head><body><div id=header_container><header><div id=header_title>ぶろぐ</a></div><ul id=globalNavi><li><a id=navi_home href=https://OrangeCocoa.github.io/index.html>TOPページ</a></li></ul></header></div><div><div id=page_side_column_area><details><summary id=page_side_column_area_head>記事カテゴリ一覧</summary><details><summary style=padding-left:1rem><a id=page_side_column_category href=https://OrangeCocoa.github.io/%E6%8A%80%E8%A1%93%E7%B3%BB%E3%81%9D%E3%81%AE%E4%BB%96/index.html>技術系その他</a></summary><a href=/%E6%8A%80%E8%A1%93%E7%B3%BB%E3%81%9D%E3%81%AE%E4%BB%96/hugo%E3%81%A7%E3%83%96%E3%83%AD%E3%82%B0%E4%BD%9C%E3%81%A3%E3%81%9F/ style=padding-left:2rem>Hugoでブログ作った</a><br></details><br><details><summary style=padding-left:1rem><a id=page_side_column_category href=https://OrangeCocoa.github.io/%E3%83%88%E3%83%AD%E3%83%95%E3%82%A3%E3%83%BC/index.html>トロフィー</a></summary><a href=/%E3%83%88%E3%83%AD%E3%83%95%E3%82%A3%E3%83%BC/%E3%82%BC%E3%83%B3%E3%83%AC%E3%82%B9%E3%82%BE%E3%83%BC%E3%83%B3%E3%82%BC%E3%83%AD/ style=padding-left:2rem>【トロコン】ゼンレスゾーンゼロ</a><br></details><br></details></div><div id=page_contents_body><div id=page_contents_date>2024.08.02</div><div id=page_contents_title>Hugoでブログ作った</div><div><a href=https://OrangeCocoa.github.io//tags/html>#HTML</a></div><div id=page_contents_text><p>ホームページを公開する方法なんて何も知らないし、WordPressもまともに使えず挫折したことがあるけども、ふと<a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>で作ってみようと思い至る。</p><p>公開先をGitHub PagesにするかNetlifyにするかで迷いましたが、いろいろとめんどくさくないGitHubPagesに決定。<br>登録するサービスが少なく済むしね。<br>ちなみに二つとも費用はかかりません。（無料じゃなかったらやってない）</p><p>注意点ですが、<a href=https://docs.github.com/ja/pages/getting-started-with-github-pages/about-github-pages#github-pages%E3%81%AE%E5%88%A9%E7%94%A8%E4%B8%8A%E3%81%AE%E5%88%B6%E9%99%90 target=_blank rel=noopener>GitHub Pages</a>はアフィリエイトやエロサイトなどの運用は恐らく認められていないので、やらないように。</p><p>GitHubでソースコード公開してるので、気になったら参考にどうぞ。<br><a href=https://github.com/OrangeCocoa/Hugo_OrangeCocoa.github.io target=_blank rel=noopener>https://github.com/OrangeCocoa/Hugo_OrangeCocoa.github.io</a></p><p><strong>目次</strong></p><ul><li><a href=#install>Hugoのインストール</a></li><li><a href=#setup>Hugoのセットアップ</a></li><li><a href=#GitHub>GitHub リポジトリの作成と、GitHub Actionsへのフック</a></li><li><a href=#error>デプロイエラー解決</a></li><li><a href=#comment>コメント欄の追加</a></li><li><a href=#link>リンクを別タブで開く</a></li><li><a href=#mermaid>mermaid記法を使う</a></li></ul><h2 id=install>Hugoのインストール</h2><hr><p><a href=https://gohugo.io/installation/ target=_blank rel=noopener>ここからDL</a><br>Windowsなので</p><p class=deco_background_black><code>winget install Hugo.Hugo.Extended</code></p><p>でインストール。</p><p>環境変数に登録までされるので、これが一番楽。</p><h2 id=setup>Hugoのセットアップ</h2><hr><p>コマンドプロンプトを開き、</p><p class=deco_background_black><code>hugo new site [Hugoプロジェクト名]</code></p><p>を実行すると、Hugoのプロジェクトが新規作成される。</p><p>いくつかフォルダが作られるが、よく使うのは<strong>content</strong>, <strong>layouts</strong>, <strong>static</strong>の三つ。<br>また<strong>hugo.toml</strong>はプロジェクトの設定ファイルになるので、これもよく編集する。</p><p class=deco_background_black><code>hugo</code></p><p>コマンドを実行すると、<strong>public</strong>フォルダにビルドされる。<br>今回はGitHub Actionsにビルドを任せるので使わなくてもOK。</p><h2 id=GitHub>GitHub リポジトリの作成と、GitHub Actionsへのフック</h2><hr><p>GitHubにHugoのデプロイ先と、Hugoプロジェクトの二つのリポジトリを作る。<br>このとき、Hugoのデプロイ先はどうもGitHubアカウント名と同じ名前を使わないといけないそう。（ほんとか？）<br>アカ名は<strong>OrangeCocoa</strong>なので、ブランチ名は<strong>OrangeCocoa.github.io</strong>。<br>WebページのURLは<strong><a href=https://OrangeCocoa.github.io target=_blank rel=noopener>https://OrangeCocoa.github.io</a></strong>になる想定。</p><p>諸兄ならばリポジトリの作り方くらい知っていようが、一応手順を記載する。</p><ol><li><p>WebのGitHubで空のHugoデプロイ先と、Hugoプロジェクトのリモートリポジトリを作成。</p></li><li><p><a href=https://git-fork.com/ target=_blank rel=noopener>Fork</a>を使ってる場合、File > Init New RepositoryでHugoプロジェクトのフォルダを選択してローカルリポジトリを作成。（Hugoデプロイ先はいらない）</p></li><li><p>Hugoプロジェクトのローカルリポジトリタブを選択している状態で、右上にあるConsoleボタンを押してコマンドプロンプトを開き、下記コマンドを実行。<br>その後プッシュすればリモートブランチ作成コミットとなる。</p></li></ol><p class=deco_background_black><code>git remote add origin https://github.com/[アカウント名]/[リポジトリ名]</code></p><p>それが済んだらデプロイアクセス用のSSH鍵を登録していく。</p><p>コマンドで</p><p class=deco_background_black><code>ssh-keygen -t ed25519 -f blog_ssh</code></p><p>など実行して適当に公開鍵と秘密鍵を作る。</p><figure><img src=/images/sshkey.png width=1200></figure><p>次に公開鍵（.pubとついてる方）をHugoのデプロイ先リポジトリに登録。<br>メモ帳などのテキストエディタで開いてコピペ。</p><p class=deco_background_red>このとき、Allow write accessにチェックを入れるのを忘れずに。<br>書き込み権限がなくてデプロイに失敗する。</p><figure><img src=/images/deploykey.png width=1200></figure><p>続いてHugoプロジェクトのリポジトリに秘密鍵を登録。<br>ここで書いたTitleが実行ファイルのシークレット指定に必要になってくるのでコピペ。</p><figure><img src=/images/secretkey.png width=1200></figure><p>その後、プロジェクト直下から <code>.github/workflows/gh-pages.yml</code> ファイルを作成して以下の実行処理を記載。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gh-pages.yml data-lang=gh-pages.yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>github pages</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>master </span> <span style=color:#75715e># Set a branch name to trigger deployment</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>submodules</span>: <span style=color:#66d9ef>true</span>  <span style=color:#75715e># Fetch Hugo themes (true OR recursive)</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>fetch-depth</span>: <span style=color:#ae81ff>0</span>    <span style=color:#75715e># Fetch all history for .GitInfo and .Lastmod</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Setup Hugo</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-hugo@v2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>hugo-version</span>: <span style=color:#e6db74>&#39;latest&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>hugo --minify</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-gh-pages@v3</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>deploy_key</span>: <span style=color:#ae81ff>${{ secrets.DEPLOY_SECRET }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>external_repository</span>: <span style=color:#ae81ff>OrangeCocoa/OrangeCocoa.github.io</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>publish_branch</span>: <span style=color:#ae81ff>master</span>
</span></span></code></pre></div><p>上記が終わったらHugoプロジェクトをコミットする。</p><p>添付画像のとおりビルドが通れば成功。<br>ちなみに自分は何度か失敗した。（<a href=#error>デプロイエラー解決</a>に続く）</p><figure><img src=/images/completejob.png width=1200></figure><h3 id=error>デプロイエラー解決</h3><hr><p class=deco_background_red><strong>「Waiting for a runner to pick up this job&mldr;」</strong></p><p>Actions上で上記のように表示されてジョブがスタートしない場合、OS指定がミスってるのでubuntu-latestを指定。</p><p class=deco_background_red><strong>Error: fatal: No url found for submodule path &lsquo;public&rsquo; in .gitmodules</strong></p><p>のエラーでBuildが止まった場合、publicやresourcesフォルダなどのHugoが生成するフォルダがデプロイ先リポジトリに含まれているので、削除しておく。</p><p class=deco_background_red><strong>Error: Unable to locate config file or config directory. Perhaps you need to create a new site.</strong></p><p>が出た場合、hugo-version指定が古くてhugo.tomlでなくconfig.tomlを探しに行ってるので、&rsquo;latest&rsquo;指定しておく。</p><p class=deco_background_red><strong>ERROR: The key you are authenticating with has been marked as read only.</strong></p><p>が出た場合、デプロイキーに書き込み権限がないのでデプロイキーを登録しなおすこと。</p><p class=deco_background_red><strong>Error: Action failed with &ldquo;not found deploy key or tokens&rdquo;</strong></p><p>が出た場合、シークレットが登録されていない。</p><p class=deco_background_red><strong>Error loading key &ldquo;/home/runner/.ssh/github&rdquo;: error in libcrypto</strong></p><p>が出た場合、シークレットの<br>&mdash;&ndash;BEGIN OPENSSH PRIVATE KEY&mdash;&ndash;<br>&mdash;&ndash;END OPENSSH PRIVATE KEY&mdash;&ndash;<br>を削って登録した疑惑。全部コピペして。</p><h2 id=comment>コメント欄の追加</h2><hr><p><a href=https://disqus.com/ target=_blank rel=noopener>Disqus</a>と<a href=https://utteranc.es/ target=_blank rel=noopener>utterances</a>がある。<br>utterancesが楽そうなのでこっちにした。<br>ログイン必須ですがコメントがGitHub issue に保存される模様。<br>（Disqusもログイン必須）</p><p><a href=https://github.com/apps/utterances target=_blank rel=noopener>utterances app</a>をインストール。</p><p>その後、single.htmlのフッター直前に以下のコードを挿入するだけでコメントが表示される。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-single.html data-lang=single.html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://utteranc.es/client.js&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>repo</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;OrangeCocoa/OrangeCocoa.github.io&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>issue-term</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pathname&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>theme</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;github-light&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>crossorigin</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;anonymous&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>async</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>Disqusも導入してみたところ、コンソール画面でコメントの集計や削除ができるといった感じで、
しっかり運営するならDisqusの方がよさそうだけど、GitHubで完結する楽さには抗えなかった。</p><h2 id=link>リンクを別タブで開く</h2><hr><p>どうやらレンダリング（MarkdownをHTMLコードに変換することをそう呼ぶらしい）処理をオーバーライドする必要がある模様。<br><del>（よく使うんだから最初から使えるようにしとけ）</del></p><p><code>layouts/_default/_markup/render-link.html</code><br>を新規作成し、下記コードを記載。<br>インデントしたら意図しない空白が入るようにレンダリングされたので一行にまとめた。<br>誰か原因教えて。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-render-link.html data-lang=render-link.html><span style=display:flex><span>&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{ .Destination | safeURL }}&#34;</span> <span style=color:#960050;background-color:#1e0010>{{</span> <span style=color:#a6e22e>with</span> <span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>Title</span> <span style=color:#960050;background-color:#1e0010>}}</span> <span style=color:#a6e22e>title</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{ . }}&#34;</span><span style=color:#960050;background-color:#1e0010>{{</span> <span style=color:#a6e22e>end</span> <span style=color:#960050;background-color:#1e0010>}}</span> <span style=color:#960050;background-color:#1e0010>{{</span> <span style=color:#a6e22e>if</span> <span style=color:#a6e22e>strings</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>HasPrefix</span> <span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>Destination</span> <span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#a6e22e>http</span><span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#960050;background-color:#1e0010>}}</span> <span style=color:#a6e22e>target</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_blank&#34;</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;noopener&#34;</span><span style=color:#960050;background-color:#1e0010>{{</span> <span style=color:#a6e22e>end</span> <span style=color:#960050;background-color:#1e0010>}}</span>&gt;{{.Text}}&lt;/<span style=color:#f92672>a</span>&gt;
</span></span></code></pre></div><h2 id=mermaid>mermaid記法を使う</h2><hr><p><code>layouts/_default/_markup/render-codeblock-mermaid.html</code><br>を新規作成し、下記コードを記載。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-render-codeblock-mermaid.html data-lang=render-codeblock-mermaid.html><span style=display:flex><span>&lt;<span style=color:#f92672>pre</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mermaid&#34;</span>&gt;
</span></span><span style=display:flex><span>	{{- .Inner | safeHTML }}
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>pre</span>&gt;
</span></span><span style=display:flex><span>{{ .Page.Store.Set &#34;hasMermaid&#34; true }}
</span></span></code></pre></div><p>既存ファイルの末尾あたりに下記コードを挿入。<br>footerに入れた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-footer.html data-lang=footer.html><span style=display:flex><span>{{ if .Store.Get &#34;hasMermaid&#34; }}
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;module&#34;</span>&gt;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>mermaid</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs&#39;</span>;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mermaid</span>.<span style=color:#a6e22e>initialize</span>({ <span style=color:#a6e22e>startOnLoad</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> });
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>{{ end }}
</span></span></code></pre></div><p>これだけでMarkdown挿入が可能になる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown.md data-lang=markdown.md><span style=display:flex><span>sequenceDiagram
</span></span><span style=display:flex><span>    participant Alice
</span></span><span style=display:flex><span>    participant Bob
</span></span><span style=display:flex><span>    Alice-&gt;&gt;John: Hello John, how are you?
</span></span><span style=display:flex><span>    loop Healthcheck
</span></span><span style=display:flex><span>        John-&gt;&gt;John: Fight against hypochondria
</span></span><span style=display:flex><span>    end
</span></span><span style=display:flex><span>    Note right of John: Rational thoughts &lt;<span style=color:#f92672>br</span>/&gt;prevail!
</span></span><span style=display:flex><span>    John--&gt;&gt;Alice: Great!
</span></span><span style=display:flex><span>    John-&gt;&gt;Bob: How about you?
</span></span><span style=display:flex><span>    Bob--&gt;&gt;John: Jolly good!
</span></span></code></pre></div><pre class=mermaid>sequenceDiagram
    participant Alice
    participant Bob
    Alice->>John: Hello John, how are you?
    loop Healthcheck
        John->>John: Fight against hypochondria
    end
    Note right of John: Rational thoughts <br>prevail!
    John-->>Alice: Great!
    John->>Bob: How about you?
    Bob-->>John: Jolly good!
</pre></div><script src=https://utteranc.es/client.js repo=OrangeCocoa/OrangeCocoa.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><script type=module>
            import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ startOnLoad: true });
        </script><footer><div id=footer_rights>© 2024 ぶろぐ All rights reserved.</div></footer></body></html>